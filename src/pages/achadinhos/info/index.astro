---
import Layout from "../../../layouts/MainLayout.astro";
import Global from '../../../components/global.astro';
import Info from '../../../components/achadinhos/info.astro';
import Seo from "../../../../public/lib/seo/metadada.astro";

// 1. Identificar o ID do produto (Exemplo usando Query Param: ?id=123)
// Se sua rota for [id].astro, use: const { id } = Astro.params;
const productId = Astro.url.searchParams.get('id');

// 2. Definir valores padrão (caso a API falhe ou não tenha ID)
let seoData = {
  title: "O Seu Próximo Essencial Está Aqui | Baú de Promoção",
  description: "Bem-vindo ao Baú de Promoções...",
  image: "https://baudepromocao.vercel.app/og/ogmain.png" // Imagem default importante
};

// 3. Fazer o Fetch no Servidor (Server-Side)
if (productId) {
  try {
    // Substitua pela URL real da sua API/JSON
    const response = await fetch(`https://baudepromocao.vercel.app/data/achadinhos.json`);
    
    if (response.ok) {
      const product = await response.json();
      
      // Atualiza os dados de SEO com o retorno da API
      // Ajuste 'product.img', 'product.nome' conforme o seu JSON real
      seoData.image = product.img || seoData.image; 
      seoData.title = product.nome ? `${product.nome} | Baú` : seoData.title;
      seoData.description = product.descricao || seoData.description;
    }
  } catch (error) {
    console.error("Erro ao buscar dados do produto para SEO:", error);
  }
}
---

<Seo 
  type="article" 
  ogTitle={seoData.title} 
  description={seoData.description}
  image={seoData.image}
/>

<Layout>
    <link rel="stylesheet" href="/styles/pages/produtos.css">
    
    <section class="hero-section" style="position: relative;">
        <div class="faq-wrapper">
            <a href="/achadinhos" class="btn-back">
              <svg class="icon-back" viewBox="0 0 24 24" fill="none" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                <line x1="19" y1="12" x2="5" y2="12"></line>
                <polyline points="12 19 5 12 12 5"></polyline>
              </svg>
              Voltar
            </a>
            
            <h1>{productId ? 'Oferta Encontrada' : 'Melhores Produtos do Baú'}</h1>
            <p>Apenas produtos selecionados</p>
        </div>
    </section> 

    <div class="main-container">
        <div id="content-area" class="detail-card">
            <div class="loading-container">
                <p style="margin-top: 20px; color: var(--text-muted); font-weight: 600;">Carregando melhor oferta...</p>
            </div>
        </div>
    </div>

    <div id="toast-box" class="toast"></div>

    <div id="login-modal" class="modal-overlay">
       <div style="background: white; padding: 40px; border-radius: 25px; text-align: center; max-width: 380px; width: 90%; box-shadow: 0 25px 50px rgba(0,0,0,0.2);">
           <button onclick="document.getElementById('login-modal').style.display='none'" style="background: transparent; border: none; color: #666; margin-top: 20px; cursor: pointer; font-weight: 600; font-size: 0.9rem;">
                Cancelar
            </button>
       </div>
    </div>
    
    <Global></Global>
    <Info></Info>
</Layout>